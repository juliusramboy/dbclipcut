<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon"   type="logo"   href="/last try/login_img/gengeng.png">
    <link rel="stylesheet" href="/grid.css"/>
    <link rel="stylesheet" href="/profile/profile.css"/>
    <link rel="stylesheet" href="/app.css">

    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@200;300;400;600;700;900&display=swap" rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css" integrity="sha512-tS3S5qG0BlhnQROyJXvNjeEM4UpMXHrQfTGmbQ1gKmelCxlSEBUaxhRBj/EFTzpbP4RVSrpEikbmdJobCvhE3g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.min.css" integrity="sha512-sMXtMNL1zRzolHYKEujM2AqCLUR9F2C4/05cdbxjjLSRvMQIciEPCQZo++nk7go3BtSuK9kfa/s+a4f4i5pLkw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>GengGeng</title> 
</head>
<body> 

<div class="nav-wrapper">
    <div class="container">
        <div class="nav">
            <a href="/index.html" class="logo">
                <i class='bx bx-movie-play bx-tada main-color'></i>Clip<span class="main-color">Watch</span>
            </a>
            <ul class="nav-menu" id="nav-menu">
                <li><a href="/last try/index.html">Home</a></li>
                <li><a href="/last try/index.html">Movies</a></li>
                <li><a href="/last try/index.html">Series</a></li>        
                <li><a href="/last try/index.html">Anime</a></li>
                <li><a href="/last try/index.html">About</a></li>  
                <li><a btn class="btn profile-container" href="/login.html "><span class="text">Sign Out</span></a></li>  
                              
            </ul>       

            <div class="hamburger-menu" id="hamburger-menu">
                <div class="hamburger"></div>
            </div>
        </div>
    </div>
</div>

<!----Profile para kay juls--->
<div class="profileuser-container">         
    <div class="profile-wrapper">
        <div class="user-img-and-email">
            <img id="profilePictureInput"  class="userimg" src="/last try/login_img/gengeng.png" >
            <div class="user-name-email">
                <h1  class="user-username" id="name">Username</h1>
                <h2 class="user-email" id="email">qwetyyy@gmail.com</h2>
            </div>
        </div>
    </div>          
    <div class="user-content">  
        <div class="dropdown-profile">
            <button class="dropbtn">Change Credential<i class='bx bxs-down-arrow'></i></button>
            <div class="dropdown-content">
              <a href="membership.html">Membership</a>
              <a href="preference.html">Preferences</a>
              <a href="credential.html">Email Notifications</a>
              <a href="preference.html">Change Credential</a>   
              <a href="preference.html">Order History</a>
              <a href="preference.html">Payment Methods</a>
            </div>
        </div>          
        <div class="user-container-wrapper">    
            <a href="/profile/membership.html"><p class="profile-select">Membership Info</p></a>
            <a href="/last try/profile/preference.html"><p class="profile-select">Preferences</p></a>
            <a href="#"><p class="profile-select ">Email Notifications</p></a>
            <a href="/last try/profile/credential.html"><p class="profile-select p">Change Credential</p></a>  
            <a href="#"><p class="profile-select">Order History</p></a>
            <a href="#"><p class="profile-select">Payment Methods</p></a>
        </div>  
        <div class="user-container">
            <div class="user-content-info">
                <span class="content-labels">General Settings:
                    <p class="user-labels">Account name: 
                        <span id="Cred_name">Username</span>
                    </p>    
                    <p class="user-labels">Birthday: 
                        <input type="text" placeholder="New Birthday" id="new-bday" class="inputs"> 
                    </p>
                    <p class="user-labels">Gender:  
                        <select id="new-gender" class="inputs">
                            <option value="">Select Gender</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Others (LGBTQ++)">Others (LGBTQ++)</option>
                            <option value="Prefer not to say">Prefer not to say</option>
                        </select>
                    </p>  
                </span> 
                <span class="content-labels">Contact Info:  
                    <p class="user-labels">Email: 
                        <span class="user-labes-cotent" id="Cred_email"> </span>
                    </p>
                    <p class="user-labels">Phone: 
                        <input type="text" placeholder="Update Phone Number" id="new-number" class="inputs">
                    </p>    
                </span>
                <span class="content-labels">Security:         
                    <p class="user-labels">Change password:  
                        <input type="text" placeholder="type your email to send code" id="new-email" class="inputs">
                        <button id="updatebtn">Send</button>
                    </p>
                </span> 
                <button id="update-general-btn">Update</button> 
                <form id="profilePictureForm">
                    <input type="file" id="img-input" accept="image/*">
                    <button type="submit">Upload Picture</button>
                </form>
            </div>      
        </div>
        
              
        </div>      
    </div>
</div>  
        
</div>  
<!--End na-->

<!--Recent view carousel-->
<div class="recent-wrap">
    <div class="recent">Recent Views</div>      
    <div class="owl-carousel" id="recent">
        <a href="#" class="movie-item">
            <img src="/last try/images/series/supergirl.jpg" alt="">
            <div class="movie-item-content">
                <div class="movie-item-title">
                    Supergirl
                </div>
                <div class="movie-infos">
                    <div class="movie-info">
                        <i class="bx bxs-star"></i>
                        <span>9.5</span>
                    </div>
                    <div class="movie-info">
                        <i class="bx bxs-time"></i>
                        <span>120 mins</span>
                    </div>
                    <div class="movie-info">
                        <span>HD</span>
                    </div>
                    <div class="movie-info">
                        <span>16+</span>
                    </div>
                </div>  
            </div>
        </a>
        <a href="#" class="movie-item">
            <img src="/last try/images/series/stranger-thing.jpg" alt="">
            <div class="movie-item-content">
                <div class="movie-item-title">
                    Stranger Things
                </div>
                <div class="movie-infos">
                    <div class="movie-info">    
                        <i class="bx bxs-star"></i>
                        <span>9.5</span>
                    </div>
                    <div class="movie-info">
                        <i class="bx bxs-time"></i>
                        <span>120 mins</span>
                    </div>
                    <div class="movie-info">
                        <span>HD</span>
                    </div>
                    <div class="movie-info">
                        <span>16+</span>
                    </div>
                </div>
            </div>
        </a>
        <a class="movie-item">
            <img src="/last try/images/cartoons/demon-slayer.jpg" alt="">
            <div class="movie-item-content">
                <div class="movie-item-title">
                    Demon Slayer
                </div>
                <div class="movie-infos">
                    <div class="movie-info">
                        <i class="bx bxs-star"></i>
                        <span>9.5</span>
                    </div>
                    <div class="movie-info">
                        <i class="bx bxs-time"></i>
                        <span>120 mins</span>
                    </div>
                    <div class="movie-info">
                        <span>HD</span>
                    </div>
                    <div class="movie-info">
                        <span>16+</span>
                    </div>
                </div>
            </div>
        </a>
        <a href="#" class="movie-item">
            <img src="/last try/images/cartoons/over-the-moon.jpg" alt="">
            <div class="movie-item-content">
                <div class="movie-item-title">
                    Over The Moon
                </div>
                <div class="movie-infos">
                    <div class="movie-info">
                        <i class="bx bxs-star"></i>
                        <span>9.5</span>
                    </div>
                    <div class="movie-info">
                        <i class="bx bxs-time"></i>
                        <span>120 mins</span>
                    </div>
                    <div class="movie-info">
                        <span>HD</span>
                    </div>
                    <div class="movie-info">
                        <span>16+</span>
                    </div>
                </div>
            </div>
        </a>
        <a href="#" class="movie-item">
            <img src="/last try/images/movies/theatre-dead.jpg" alt="">
            <div class="movie-item-content">
                <div class="movie-item-title">
                    Theatre of the dead
                </div>
                <div class="movie-infos">
                    <div class="movie-info">
                        <i class="bx bxs-star"></i>
                        <span>9.5</span>
                    </div>
                    <div class="movie-info">
                        <i class="bx bxs-time"></i>
                        <span>120 mins</span>
                    </div>
                    <div class="movie-info">
                        <span>HD</span>
                    </div>
                    <div class="movie-info">
                        <span>16+</span>
                    </div>
                </div>
            </div>
        </a>
        <a href="#" class="movie-item">
            <img src="/last try/images/movies/transformer.jpg" alt="">
            <div class="movie-item-content">
                <div class="movie-item-title">
                    Transformer
                </div>
                <div class="movie-infos">
                    <div class="movie-info">
                        <i class="bx bxs-star"></i>
                        <span>9.5</span>
                    </div>
                    <div class="movie-info">
                        <i class="bx bxs-time"></i>
                        <span>120 mins</span>
                    </div>
                    <div class="movie-info">
                        <span>HD</span>
                    </div>
                    <div class="movie-info">
                        <span>16+</span>
                    </div>
                </div>
            </div>
        </a>
    </div>
</div>
<!---->

<!--FOOTER-->
    <footer id="e"class="section">
        <div class="container">
        <div class="row">
            <div class="col-4 col-md-6 col-sm-12">
                <div class="content">
                    <a  href="#" class="logo">
                        <i class='bx bx-movie-play bx-tada main-color'></i>Clip<span class="main-color">Watch</span>
                    </a>
                    <p>
                        We've upgraded your streaming experience with a sleek new interface, better content, and personalized recommendations. Download our mobile app, connect with fellow enthusiasts, and stay tuned for more updates. Happy streaming!
                    </p>
                    <div class="social-list">
                        <a href="#" class="social-item">
                            <i class="bx bxl-facebook"></i>
                        </a>
                        <a href="#" class="social-item">
                            <i class="bx bxl-twitter"></i>
                        </a>
                        <a href="#" class="social-item">
                            <i class="bx bxl-instagram"></i>
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-8 col-md-6 col-sm-12">
                <div class="row">
                    <div class="col-3 col-md-6 col-sm-6">
                        <div class="content">
                            <p><b>ClipWatch</b></p>
                            <ul class="footer-menu">
                                <li><a href="team.html">Our Team</a></li>                                   
                            </ul>
                        </div>
                    </div>
                    <div class="col-3 col-md-6 col-sm-6">
                        <div class="content">
                            <p><b>Browse</b></p>
                            <ul class="footer-menu">
                                <li><a href="#a">Movies</a></li>
                                <li><a href="#b">Series</a></li>
                                <li><a href="#c">Anime</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-3 col-md-6 col-sm-6">
                        <div class="content">
                            <p><b>Help</b></p>
                            <ul class="footer-menu">
                                <li><a href="#">Term of Use</a></li>
                                <li><a href="#">Media Center</a></li>
                                <li><a href="#">Privacy</a></li>
                                <li><a href="#">Contacts Us</a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="col-3 col-md-6 col-sm-6">
                        <div class="content">
                            <p><b>Download app</b></p>
                            <ul class="footer-menu">
                                <li>
                                    <a href="https://play.google.com/">
                                        <img src="/last try/images/google-play.png" alt="">
                                    </a>
                                </li>
                                <li>
                                    <a href="https://www.apple.com/ph/app-store/">
                                        <img src="/last try/images/app-store.png" alt="">
                                    </a>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</footer>

<div class="copyright">
    Copyright 2023 <a href="#" target="_blank">
        all Rights Reserve</a>
</div>

   
<!---script Hambuger-->
<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
<!---script Owl carousel-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js" integrity="sha512-bPs7Ae6pVvhOSiIcyUClR7/q2OAsRiovw4vAkX+zJbw3ShAeeqezq50RIIcIURq7Oa20rW2n2q+fyXBNcU9lrw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<!---script Hambuger and Carousel-->
<script src="/last try/app.js"></script>

<!---owlCarousel-->
<script type="text/javascript">
    $('#recent').owlCarousel({
        loop:false,
        nav:false,
        dots:false,
        rlt:true,
        margin: 15,
        responsive:{
            300: {
                items: 2
            },
            500: {
                items: 3
            },
            1280: {
                items: 4
            },
            1600: {
                items: 5        
            }
    }   
    })
</script>

<!---
<script>
     const img = document.getElementById('userimg');
     const inpimg = document.getElementById('image-file');

    inpimg.onchange = function(){
        img.src = URL.createObjectURL(inpimg.files[0]);
    }

</script>
-->
<!--
<script src="dropdown.js"></script>
<script>
    const editbtn = document.getElementById('edit-btn');
    const updatebtn = document.getElementById('upt-btn');
    const input = document.querySelectorAll('.inputs');
    
    updatebtn.addEventListener('click', ()=>{   
        input.forEach(input => {
            input.disabled = false;
            input.style.border = '1.8px solid #dbb42c';
        });
    })  
    editbtn.addEventListener('click', ()=>{   
        input.forEach(input => {
            input.disabled = true;
            input.style.border = 'none';
        });
    })   
</script>
-->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
import { getAuth, sendPasswordResetEmail, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
import { getDatabase, ref, onValue, update } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-database.js";


const firebaseConfig = {
apiKey: "AIzaSyBrKgmtuJDPt5edV8mgqZZHYr_tls02wg4",
authDomain: "clip-watch-c41d9.firebaseapp.com",
databaseURL: "https://clip-watch-c41d9-default-rtdb.firebaseio.com",
projectId: "clip-watch-c41d9",
storageBucket: "clip-watch-c41d9.appspot.com",
messagingSenderId: "747823041806",
appId: "1:747823041806:web:6d677aec8f14fbaf4edb5f"
};

// Initialization
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth(app);

// Listen for changes in authentication state
onAuthStateChanged(auth, (user) => {
    if (user) {
        // User is signed in
        const userId = user.uid;
        const userRef = ref(db, `users/${userId}`);

        // Fetch user data from the database
        onValue(userRef, (snapshot) => {
            const userData = snapshot.val();
            if (userData) {
                // Update HTML elements with user data
                document.getElementById("name").textContent = userData.name || "Username";
                document.getElementById("email").textContent = userData.email || "Email";
                document.getElementById("Cred_email").textContent = userData.email || "Email";
                document.getElementById("Cred_name").textContent = userData.name || "Username";
            }
        });
    } else {        
    }
});


// Update and add info bday, number, gender
document.getElementById("update-general-btn").addEventListener("click", () => {
    const newBirthday = document.getElementById("new-bday").value.trim();
    const newGender = document.getElementById("new-gender").value.trim();
    let newNumber = document.getElementById("new-number").value.trim();

    const user = auth.currentUser;
    if (user) {
        const userId = user.uid;
        const userRef = ref(db, `users/${userId}`);

        // Create a object to store the fields to be updated
        let updates = {};

        // Validate and update the birthday field
        if (/^[0-9/]*$/.test(newBirthday)) {
            updates.birthday = newBirthday;
        } else {
            alert("Invalid birthday format. Please enter numbers and / only.");
            return;
        }

        // Validate and update the gender field
        if (newGender !== "") {
            if (newGender === "Male" || newGender === "Female" || newGender === "Others (LGBTQ++)" || newGender === "Prefer not to say") {
                updates.gender = newGender;
            } else {
                alert("Invalid gender selection.");
                return;
            }
        }

        // Validate and limit the phone number to 11 digits
        if (newNumber !== "") {
            if (/^\d{11}$/.test(newNumber)) {
                updates.nohp = newNumber;
            } else {
                alert("Phone number must be 11 digits.");
                return;
            }
        }

        // Update the data in the database
        update(userRef, updates)
            .then(() => {
                alert("Profile updated successfully!");
            })
            .catch((error) => {
                console.error("Error updating profile:", error);
                alert("Failed to update profile. Please try again.");
            });
    }
});



// update password using fcking email
const reset = document.getElementById("updatebtn");

reset.addEventListener("click", function(){
    event.preventDefault();

    const email = document.getElementById("new-email").value;
    sendPasswordResetEmail(auth, email)
    .then(() => {
        alert("Email sent successfully.");
    })
    .catch((error) => {
        const errorCode = error.code;
        const errorMessage = error.message;
        alert(errorMessage);
    });
});

   

    // para sa picture nya naka oki 
onAuthStateChanged(auth, (user) => {
    if (user) {
        // User is signed in
        const userId = user.uid;
        const userRef = ref(db, `users/${userId}`);

        // Fetch user data from the database
        onValue(userRef, (snapshot) => {
            const userData = snapshot.val();
            if (userData) {
                // Update HTML elements with user data
                document.getElementById("name").textContent = userData.name || "Username";
                document.getElementById("Cred_name").textContent = userData.name || "Username";

                // Check if the user has a profile picture
                const profilePictureUrl = userData.profilePicture;
                if (profilePictureUrl) {
                    // If a profile picture exists, update the src attribute of the img tag
                    document.getElementById("profilePictureInput").src = profilePictureUrl;
                }

                // Check if the user signed in with Google
                if (user.providerData[0].providerId === "google.com") {
                    // If signed in with Google, display the email, display name, and profile picture provided by Google
                    document.getElementById("email").textContent = user.email || "Email";
                    document.getElementById("Cred_email").textContent = user.email || "Email";

                    // Update the display name in the Google account
                    user.updateProfile({
                        displayName: userData.name || "Username"
                    }).then(() => {
                        // Update successful
                    }).catch((error) => {
                        console.error("Error updating display name:", error);
                    });
                } else {
                    // If not signed in with Google, display the email and display name from the database
                    document.getElementById("email").textContent = userData.email || "Email";
                }
            }
        });
    } else {
        alert("No User Found");
    }
});

// Handle profile picture uploads
const profilePictureForm = document.getElementById("profilePictureForm");

profilePictureForm.addEventListener("submit", (e) => {
    e.preventDefault(); // Prevent default form submission

    const file = profilePictureForm.querySelector("#img-input").files[0]; // Get the selected file
    if (file) {
        // Read the file as a data URL
        const reader = new FileReader();
        reader.onload = (event) => {
            const dataURL = event.target.result;
            // Update the profile picture data URL in Realtime Database
            const userId = auth.currentUser.uid;
            const userRef = ref(db, `users/${userId}`);
            update(userRef, {
                profilePicture: dataURL
            }).then(() => {
                // Update successful, update the profile picture displayed in the UI
                document.getElementById("profilePictureInput").src = dataURL;
                alert("Profile picture uploaded successfully!");
            }).catch((error) => {
                console.error("Error uploading profile picture:", error);
                alert("Failed to upload profile picture. Please try again.");
            });
        };
        reader.readAsDataURL(file);
    } else {
        alert("Please select a file to upload.");
    }
});


    // googgle_Listen for changes in authentication state
onAuthStateChanged(auth, (user) => {
    if (user) {
        // User is signed in
        const userId = user.uid;
        const userRef = ref(db, `users/${userId}`);

        // Fetch user data from the database
        onValue(userRef, (snapshot) => {
            const userData = snapshot.val();
            if (userData) {
                // Update HTML elements with user data
                document.getElementById("name").textContent = user.userData.name || "User";
                document.getElementById("Cred_name").textContent = user.userData.name || "Username";
               

                // Check if the user signed in with Google
                if (user.providerData[0].providerId === "google.com") {
                    // If signed in with Google, display the email, display name, and profile picture provided by Google
                    document.getElementById("email").textContent = user.email || "Email";
                    document.getElementById("Cred_email").textContent = user.email || "Email";
                    document.getElementById("name").textContent = user.email || "name";

                    const profilePictureUrl = user.photoURL;
                    if (profilePictureUrl) {
                        document.getElementById("profilePictureInput").src = profilePictureUrl;
                    }
                    // Update the display name in the Google account
                    user.updateProfile({
                        displayName: userData.name || "Username"
                    }).then(() => {
                        // Update successful
                    }).catch((error) => {
                        console.error("Error updating display name:", error);
                    });
                } else {
                    // If not signed in with Google, display the email and display name from the database
                    document.getElementById("email").textContent = userData.email || "Email";
                }
            }
        });
    } else {        
        // User is not signed in
    }
});


    
</script>

</body>
</html>         